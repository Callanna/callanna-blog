{"remainingRequest":"/Users/pro/Documents/WebWork/GitHub/iBlog-master/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/pro/Documents/WebWork/GitHub/iBlog-master/.nuxt/auth/auth.js","dependencies":[{"path":"/Users/pro/Documents/WebWork/GitHub/iBlog-master/.nuxt/auth/auth.js","mtime":1597482623750},{"path":"/Users/pro/Documents/WebWork/GitHub/iBlog-master/node_modules/cache-loader/dist/cjs.js","mtime":1583743859870},{"path":"/Users/pro/Documents/WebWork/GitHub/iBlog-master/node_modules/babel-loader/lib/index.js","mtime":1578715241550}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM3LmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5yZWdleHAucmVwbGFjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNy5zeW1ib2wuYXN5bmMtaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI7CmltcG9ydCBfdHlwZW9mIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgU3RvcmFnZSBmcm9tICcuL3N0b3JhZ2UnOwppbXBvcnQgeyByb3V0ZU9wdGlvbiwgaXNSZWxhdGl2ZVVSTCwgaXNTZXQsIGlzU2FtZVVSTCwgZ2V0UHJvcCB9IGZyb20gJy4vdXRpbGl0aWVzJzsKCnZhciBBdXRoID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gQXV0aChjdHgsIG9wdGlvbnMpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBdXRoKTsKCiAgICB0aGlzLmN0eCA9IGN0eDsKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7IC8vIFN0cmF0ZWdpZXMKCiAgICB0aGlzLnN0cmF0ZWdpZXMgPSB7fTsgLy8gRXJyb3IgbGlzdGVuZXJzCgogICAgdGhpcy5fZXJyb3JMaXN0ZW5lcnMgPSBbXTsgLy8gUmVkaXJlY3QgbGlzdGVuZXJzCgogICAgdGhpcy5fcmVkaXJlY3RMaXN0ZW5lcnMgPSBbXTsgLy8gU3RvcmFnZSAmIFN0YXRlCgogICAgb3B0aW9ucy5pbml0aWFsU3RhdGUgPSB7CiAgICAgIHVzZXI6IG51bGwsCiAgICAgIGxvZ2dlZEluOiBmYWxzZQogICAgfTsKICAgIHZhciBzdG9yYWdlID0gbmV3IFN0b3JhZ2UoY3R4LCBvcHRpb25zKTsKICAgIHRoaXMuJHN0b3JhZ2UgPSBzdG9yYWdlOwogICAgdGhpcy4kc3RhdGUgPSBzdG9yYWdlLnN0YXRlOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEF1dGgsIFt7CiAgICBrZXk6ICJpbml0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaW5pdCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgLy8gUmVzZXQgb24gZXJyb3IKICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVzZXRPbkVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzJG9wdGlvbnM7CgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3RoaXMub3B0aW9ucy5yZXNldE9uRXJyb3IgIT09ICdmdW5jdGlvbicgfHwgKF90aGlzJG9wdGlvbnMgPSBfdGhpcy5vcHRpb25zKS5yZXNldE9uRXJyb3IuYXBwbHkoX3RoaXMkb3B0aW9ucywgYXJndW1lbnRzKSkgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSAvLyBSZXN0b3JlIHN0cmF0ZWd5CgoKICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JhZ2Uuc3luY1VuaXZlcnNhbCgnc3RyYXRlZ3knLCB0aGlzLm9wdGlvbnMuZGVmYXVsdFN0cmF0ZWd5KTsgLy8gU2V0IGRlZmF1bHQgc3RyYXRlZ3kgaWYgY3VycmVudCBvbmUgaXMgaW52YWxpZAoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0cmF0ZWd5KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yYWdlLnNldFVuaXZlcnNhbCgnc3RyYXRlZ3knLCB0aGlzLm9wdGlvbnMuZGVmYXVsdFN0cmF0ZWd5KTsgLy8gR2l2ZSB1cCBpZiBzdGlsbCBpbnZhbGlkCgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RyYXRlZ3kpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIFByb21pc2UucmVzb2x2ZSgpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDY7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vdW50ZWQoKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTE7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDYpOwogICAgICAgICAgICAgICAgdGhpcy5jYWxsT25FcnJvcihfY29udGV4dC50MCk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTQ7CgogICAgICAgICAgICAgICAgLy8gV2F0Y2ggZm9yIGxvZ2dlZEluIGNoYW5nZXMgb25seSBpbiBjbGllbnQgc2lkZQogICAgICAgICAgICAgICAgaWYgKHByb2Nlc3MuY2xpZW50ICYmIHRoaXMub3B0aW9ucy53YXRjaExvZ2dlZEluKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JhZ2Uud2F0Y2hTdGF0ZSgnbG9nZ2VkSW4nLCBmdW5jdGlvbiAobG9nZ2VkSW4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXJvdXRlT3B0aW9uKF90aGlzLmN0eC5yb3V0ZSwgJ2F1dGgnLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJlZGlyZWN0KGxvZ2dlZEluID8gJ2hvbWUnIDogJ2xvZ291dCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmZpbmlzaCgxNCk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzLCBbWzYsIDExLCAxNCwgMTddXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgcmV0dXJuIF9pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpbml0OwogICAgfSgpIC8vIEJhY2t3YXJkIGNvbXBhdGliaWxpdHkKCiAgfSwgewogICAga2V5OiAiZ2V0U3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFN0YXRlKGtleSkgewogICAgICBpZiAoIXRoaXMuX2dldF9zdGF0ZV93YXJuX3Nob3duKSB7CiAgICAgICAgdGhpcy5fZ2V0X3N0YXRlX3dhcm5fc2hvd24gPSB0cnVlOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQoKICAgICAgICBjb25zb2xlLndhcm4oJ1tBVVRIXSAkYXV0aC5nZXRTdGF0ZSBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlICRhdXRoLiRzdG9yYWdlLmdldFN0YXRlKCkgb3IgdG9wIGxldmVsIHByb3BzIGxpa2UgJGF1dGgubG9nZ2VkSW4nKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JhZ2UuZ2V0U3RhdGUoa2V5KTsKICAgIH0gLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBTdHJhdGVneSBhbmQgU2NoZW1lCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgfSwgewogICAga2V5OiAicmVnaXN0ZXJTdHJhdGVneSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVnaXN0ZXJTdHJhdGVneShuYW1lLCBzdHJhdGVneSkgewogICAgICB0aGlzLnN0cmF0ZWdpZXNbbmFtZV0gPSBzdHJhdGVneTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRTdHJhdGVneSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U3RyYXRlZ3kobmFtZSkgewogICAgICBpZiAobmFtZSA9PT0gdGhpcy4kc3RvcmFnZS5nZXRVbml2ZXJzYWwoJ3N0cmF0ZWd5JykpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgIH0gLy8gU2V0IHN0cmF0ZWd5CgoKICAgICAgdGhpcy4kc3RvcmFnZS5zZXRVbml2ZXJzYWwoJ3N0cmF0ZWd5JywgbmFtZSk7IC8vIENhbGwgbW91bnRlZCBob29rIG9uIGFjdGl2ZSBzdHJhdGVneQoKICAgICAgcmV0dXJuIHRoaXMubW91bnRlZCgpOwogICAgfQogIH0sIHsKICAgIGtleTogIm1vdW50ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICAgIHZhciBfdGhpcyRzdHJhdGVneSwKICAgICAgICAgIF90aGlzMiA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuc3RyYXRlZ3kubW91bnRlZCkgewogICAgICAgIHJldHVybiB0aGlzLmZldGNoVXNlck9uY2UoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgoX3RoaXMkc3RyYXRlZ3kgPSB0aGlzLnN0cmF0ZWd5KS5tb3VudGVkLmFwcGx5KF90aGlzJHN0cmF0ZWd5LCBhcmd1bWVudHMpKS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBfdGhpczIuY2FsbE9uRXJyb3IoZXJyb3IsIHsKICAgICAgICAgIG1ldGhvZDogJ21vdW50ZWQnCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImxvZ2luV2l0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9naW5XaXRoKG5hbWUpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkyID0gMTsgX2tleTIgPCBfbGVuOyBfa2V5MisrKSB7CiAgICAgICAgYXJnc1tfa2V5MiAtIDFdID0gYXJndW1lbnRzW19rZXkyXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuc2V0U3RyYXRlZ3kobmFtZSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMy5sb2dpbi5hcHBseShfdGhpczMsIGFyZ3MpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsb2dpbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9naW4oKSB7CiAgICAgIHZhciBfdGhpcyRzdHJhdGVneTIsCiAgICAgICAgICBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLnN0cmF0ZWd5LmxvZ2luKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy53cmFwTG9naW4oKF90aGlzJHN0cmF0ZWd5MiA9IHRoaXMuc3RyYXRlZ3kpLmxvZ2luLmFwcGx5KF90aGlzJHN0cmF0ZWd5MiwgYXJndW1lbnRzKSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgX3RoaXM0LmNhbGxPbkVycm9yKGVycm9yLCB7CiAgICAgICAgICBtZXRob2Q6ICdsb2dpbicKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmV0Y2hVc2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFVzZXIoKSB7CiAgICAgIHZhciBfdGhpcyRzdHJhdGVneTMsCiAgICAgICAgICBfdGhpczUgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLnN0cmF0ZWd5LmZldGNoVXNlcikgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgoX3RoaXMkc3RyYXRlZ3kzID0gdGhpcy5zdHJhdGVneSkuZmV0Y2hVc2VyLmFwcGx5KF90aGlzJHN0cmF0ZWd5MywgYXJndW1lbnRzKSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgX3RoaXM1LmNhbGxPbkVycm9yKGVycm9yLCB7CiAgICAgICAgICBtZXRob2Q6ICdmZXRjaFVzZXInCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImxvZ291dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9nb3V0KCkgewogICAgICB2YXIgX3RoaXMkc3RyYXRlZ3k0LAogICAgICAgICAgX3RoaXM2ID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5zdHJhdGVneS5sb2dvdXQpIHsKICAgICAgICB0aGlzLnJlc2V0KCk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKChfdGhpcyRzdHJhdGVneTQgPSB0aGlzLnN0cmF0ZWd5KS5sb2dvdXQuYXBwbHkoX3RoaXMkc3RyYXRlZ3k0LCBhcmd1bWVudHMpKS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBfdGhpczYuY2FsbE9uRXJyb3IoZXJyb3IsIHsKICAgICAgICAgIG1ldGhvZDogJ2xvZ291dCcKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VXNlclRva2VuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRVc2VyVG9rZW4odG9rZW4pIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuc3RyYXRlZ3kuc2V0VXNlclRva2VuKSB7CiAgICAgICAgdGhpcy5zZXRUb2tlbih0aGlzLnN0cmF0ZWd5Lm5hbWUsIHRva2VuKTsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5zdHJhdGVneS5zZXRVc2VyVG9rZW4odG9rZW4pKS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBfdGhpczcuY2FsbE9uRXJyb3IoZXJyb3IsIHsKICAgICAgICAgIG1ldGhvZDogJ3NldFVzZXJUb2tlbicKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVzZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0KCkgewogICAgICB2YXIgX3RoaXMkc3RyYXRlZ3k1LAogICAgICAgICAgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5zdHJhdGVneS5yZXNldCkgewogICAgICAgIHRoaXMuc2V0VXNlcihmYWxzZSk7CiAgICAgICAgdGhpcy5zZXRUb2tlbih0aGlzLiRzdGF0ZS5zdHJhdGVneSwgZmFsc2UpOwogICAgICAgIHRoaXMuc2V0UmVmcmVzaFRva2VuKHRoaXMuJHN0YXRlLnN0cmF0ZWd5LCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKChfdGhpcyRzdHJhdGVneTUgPSB0aGlzLnN0cmF0ZWd5KS5yZXNldC5hcHBseShfdGhpcyRzdHJhdGVneTUsIGFyZ3VtZW50cykpLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIF90aGlzOC5jYWxsT25FcnJvcihlcnJvciwgewogICAgICAgICAgbWV0aG9kOiAncmVzZXQnCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgIH0pOwogICAgfSAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFRva2VuIGhlbHBlcnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICB9LCB7CiAgICBrZXk6ICJnZXRUb2tlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VG9rZW4oc3RyYXRlZ3kpIHsKICAgICAgdmFyIF9rZXkgPSB0aGlzLm9wdGlvbnMudG9rZW4ucHJlZml4ICsgc3RyYXRlZ3k7CgogICAgICByZXR1cm4gdGhpcy4kc3RvcmFnZS5nZXRVbml2ZXJzYWwoX2tleSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VG9rZW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFRva2VuKHN0cmF0ZWd5LCB0b2tlbikgewogICAgICB2YXIgX2tleSA9IHRoaXMub3B0aW9ucy50b2tlbi5wcmVmaXggKyBzdHJhdGVneTsKCiAgICAgIHJldHVybiB0aGlzLiRzdG9yYWdlLnNldFVuaXZlcnNhbChfa2V5LCB0b2tlbik7CiAgICB9CiAgfSwgewogICAga2V5OiAic3luY1Rva2VuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzeW5jVG9rZW4oc3RyYXRlZ3kpIHsKICAgICAgdmFyIF9rZXkgPSB0aGlzLm9wdGlvbnMudG9rZW4ucHJlZml4ICsgc3RyYXRlZ3k7CgogICAgICByZXR1cm4gdGhpcy4kc3RvcmFnZS5zeW5jVW5pdmVyc2FsKF9rZXkpOwogICAgfSAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFJlZnJlc2ggdG9rZW4gaGVscGVycwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIH0sIHsKICAgIGtleTogImdldFJlZnJlc2hUb2tlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmVmcmVzaFRva2VuKHN0cmF0ZWd5KSB7CiAgICAgIHZhciBfa2V5ID0gdGhpcy5vcHRpb25zLnJlZnJlc2hfdG9rZW4ucHJlZml4ICsgc3RyYXRlZ3k7CgogICAgICByZXR1cm4gdGhpcy4kc3RvcmFnZS5nZXRVbml2ZXJzYWwoX2tleSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0UmVmcmVzaFRva2VuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSZWZyZXNoVG9rZW4oc3RyYXRlZ3ksIHJlZnJlc2hUb2tlbikgewogICAgICB2YXIgX2tleSA9IHRoaXMub3B0aW9ucy5yZWZyZXNoX3Rva2VuLnByZWZpeCArIHN0cmF0ZWd5OwoKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JhZ2Uuc2V0VW5pdmVyc2FsKF9rZXksIHJlZnJlc2hUb2tlbik7CiAgICB9CiAgfSwgewogICAga2V5OiAic3luY1JlZnJlc2hUb2tlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3luY1JlZnJlc2hUb2tlbihzdHJhdGVneSkgewogICAgICB2YXIgX2tleSA9IHRoaXMub3B0aW9ucy5yZWZyZXNoX3Rva2VuLnByZWZpeCArIHN0cmF0ZWd5OwoKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JhZ2Uuc3luY1VuaXZlcnNhbChfa2V5KTsKICAgIH0gLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBVc2VyIGhlbHBlcnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICB9LCB7CiAgICBrZXk6ICJmZXRjaFVzZXJPbmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFVzZXJPbmNlKCkgewogICAgICBpZiAoIXRoaXMuJHN0YXRlLnVzZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5mZXRjaFVzZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFVzZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFVzZXIodXNlcikgewogICAgICB0aGlzLiRzdG9yYWdlLnNldFN0YXRlKCd1c2VyJywgdXNlcik7CiAgICAgIHRoaXMuJHN0b3JhZ2Uuc2V0U3RhdGUoJ2xvZ2dlZEluJywgQm9vbGVhbih1c2VyKSk7CiAgICB9IC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVXRpbHMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICB9LCB7CiAgICBrZXk6ICJyZXF1ZXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXF1ZXN0KGVuZHBvaW50LCBkZWZhdWx0cykgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHZhciBfZW5kcG9pbnQgPSBfdHlwZW9mKGRlZmF1bHRzKSA9PT0gJ29iamVjdCcgPyBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgZW5kcG9pbnQpIDogZW5kcG9pbnQ7CgogICAgICBpZiAoIXRoaXMuY3R4LmFwcC4kYXhpb3MpIHsKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBVVRIXSBhZGQgdGhlIEBudXh0anMvYXhpb3MgbW9kdWxlIHRvIG51eHQuY29uZmlnIGZpbGUnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmN0eC5hcHAuJGF4aW9zLnJlcXVlc3QoX2VuZHBvaW50KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChfZW5kcG9pbnQucHJvcGVydHlOYW1lKSB7CiAgICAgICAgICByZXR1cm4gZ2V0UHJvcChyZXNwb25zZS5kYXRhLCBfZW5kcG9pbnQucHJvcGVydHlOYW1lKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAvLyBDYWxsIGFsbCBlcnJvciBoYW5kbGVycwogICAgICAgIF90aGlzOS5jYWxsT25FcnJvcihlcnJvciwgewogICAgICAgICAgbWV0aG9kOiAncmVxdWVzdCcKICAgICAgICB9KTsgLy8gVGhyb3cgZXJyb3IKCgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlcXVlc3RXaXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXF1ZXN0V2l0aChzdHJhdGVneSwgZW5kcG9pbnQsIGRlZmF1bHRzKSB7CiAgICAgIHZhciB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oc3RyYXRlZ3kpOwoKICAgICAgdmFyIF9lbmRwb2ludCA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzLCBlbmRwb2ludCk7CgogICAgICB2YXIgdG9rZW5OYW1lID0gdGhpcy5zdHJhdGVnaWVzW3N0cmF0ZWd5XS5vcHRpb25zLnRva2VuTmFtZSB8fCAnQXV0aG9yaXphdGlvbic7CgogICAgICBpZiAoIV9lbmRwb2ludC5oZWFkZXJzKSB7CiAgICAgICAgX2VuZHBvaW50LmhlYWRlcnMgPSB7fTsKICAgICAgfQoKICAgICAgaWYgKCFfZW5kcG9pbnQuaGVhZGVyc1t0b2tlbk5hbWVdICYmIGlzU2V0KHRva2VuKSAmJiB0b2tlbikgewogICAgICAgIF9lbmRwb2ludC5oZWFkZXJzW3Rva2VuTmFtZV0gPSB0b2tlbjsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdChfZW5kcG9pbnQpOwogICAgfQogIH0sIHsKICAgIGtleTogIndyYXBMb2dpbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gd3JhcExvZ2luKHByb21pc2UpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdGhpcy4kc3RvcmFnZS5zZXRTdGF0ZSgnYnVzeScsIHRydWUpOwogICAgICB0aGlzLmVycm9yID0gbnVsbDsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShwcm9taXNlKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczEwLiRzdG9yYWdlLnNldFN0YXRlKCdidXN5JywgZmFsc2UpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBfdGhpczEwLiRzdG9yYWdlLnNldFN0YXRlKCdidXN5JywgZmFsc2UpOwoKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbkVycm9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkVycm9yKGxpc3RlbmVyKSB7CiAgICAgIHRoaXMuX2Vycm9yTGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwogICAgfQogIH0sIHsKICAgIGtleTogImNhbGxPbkVycm9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjYWxsT25FcnJvcihlcnJvcikgewogICAgICB2YXIgcGF5bG9hZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjsKICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgdmFyIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSB0aGlzLl9lcnJvckxpc3RlbmVyc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKICAgICAgICAgIHZhciBmbiA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgZm4oZXJyb3IsIHBheWxvYWQpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgIF9pdGVyYXRvci5yZXR1cm4oKTsKICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInJlZGlyZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWRpcmVjdChuYW1lKSB7CiAgICAgIHZhciBub1JvdXRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIXRoaXMub3B0aW9ucy5yZWRpcmVjdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGZyb20gPSB0aGlzLm9wdGlvbnMuZnVsbFBhdGhSZWRpcmVjdCA/IHRoaXMuY3R4LnJvdXRlLmZ1bGxQYXRoIDogdGhpcy5jdHgucm91dGUucGF0aDsKICAgICAgdmFyIHRvID0gdGhpcy5vcHRpb25zLnJlZGlyZWN0W25hbWVdOwoKICAgICAgaWYgKCF0bykgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBBcHBseSByZXdyaXRlcwoKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmV3cml0ZVJlZGlyZWN0cykgewogICAgICAgIGlmIChuYW1lID09PSAnbG9naW4nICYmIGlzUmVsYXRpdmVVUkwoZnJvbSkgJiYgIWlzU2FtZVVSTCh0bywgZnJvbSkpIHsKICAgICAgICAgIHRoaXMuJHN0b3JhZ2Uuc2V0VW5pdmVyc2FsKCdyZWRpcmVjdCcsIGZyb20pOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5hbWUgPT09ICdob21lJykgewogICAgICAgICAgdmFyIHJlZGlyZWN0ID0gdGhpcy4kc3RvcmFnZS5nZXRVbml2ZXJzYWwoJ3JlZGlyZWN0Jyk7CiAgICAgICAgICB0aGlzLiRzdG9yYWdlLnNldFVuaXZlcnNhbCgncmVkaXJlY3QnLCBudWxsKTsKCiAgICAgICAgICBpZiAoaXNSZWxhdGl2ZVVSTChyZWRpcmVjdCkpIHsKICAgICAgICAgICAgdG8gPSByZWRpcmVjdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2FsbCBvblJlZGlyZWN0IGhvb2sKCgogICAgICB0byA9IHRoaXMuY2FsbE9uUmVkaXJlY3QodG8sIGZyb20pIHx8IHRvOyAvLyBQcmV2ZW50IGluZmluaXR5IHJlZGlyZWN0cwoKICAgICAgaWYgKGlzU2FtZVVSTCh0bywgZnJvbSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChwcm9jZXNzLmNsaWVudCkgewogICAgICAgIGlmIChub1JvdXRlcikgewogICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UodG8pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmN0eC5yZWRpcmVjdCh0bywgdGhpcy5jdHgucXVlcnkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmN0eC5yZWRpcmVjdCh0bywgdGhpcy5jdHgucXVlcnkpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAib25SZWRpcmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25SZWRpcmVjdChsaXN0ZW5lcikgewogICAgICB0aGlzLl9yZWRpcmVjdExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjYWxsT25SZWRpcmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FsbE9uUmVkaXJlY3QodG8sIGZyb20pIHsKICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yMiA9IGZhbHNlOwogICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IyID0gdGhpcy5fcmVkaXJlY3RMaXN0ZW5lcnNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDI7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWUpIHsKICAgICAgICAgIHZhciBmbiA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgIHRvID0gZm4odG8sIGZyb20pIHx8IHRvOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gdHJ1ZTsKICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBlcnI7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgJiYgX2l0ZXJhdG9yMi5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICBfaXRlcmF0b3IyLnJldHVybigpOwogICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0bzsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYXNTY29wZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFzU2NvcGUoc2NvcGUpIHsKICAgICAgdmFyIHVzZXJTY29wZXMgPSB0aGlzLiRzdGF0ZS51c2VyICYmIGdldFByb3AodGhpcy4kc3RhdGUudXNlciwgdGhpcy5vcHRpb25zLnNjb3BlS2V5KTsKCiAgICAgIGlmICghdXNlclNjb3BlcykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXNlclNjb3BlcykpIHsKICAgICAgICByZXR1cm4gdXNlclNjb3Blcy5pbmNsdWRlcyhzY29wZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBCb29sZWFuKGdldFByb3AodXNlclNjb3Blcywgc2NvcGUpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdGF0ZSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgaWYgKCF0aGlzLl9zdGF0ZV93YXJuX3Nob3duKSB7CiAgICAgICAgdGhpcy5fc3RhdGVfd2Fybl9zaG93biA9IHRydWU7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCgogICAgICAgIGNvbnNvbGUud2FybignW0FVVEhdICRhdXRoLnN0YXRlIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgJGF1dGguJHN0YXRlIG9yIHRvcCBsZXZlbCBwcm9wcyBsaWtlICRhdXRoLmxvZ2dlZEluJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLiRzdGF0ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdHJhdGVneSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RyYXRlZ2llc1t0aGlzLiRzdGF0ZS5zdHJhdGVneV07CiAgICB9CiAgfSwgewogICAga2V5OiAidXNlciIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0YXRlLnVzZXI7CiAgICB9CiAgfSwgewogICAga2V5OiAibG9nZ2VkSW4iLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdGF0ZS5sb2dnZWRJbjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJidXN5IiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmFnZS5nZXRTdGF0ZSgnYnVzeScpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEF1dGg7Cn0oKTsKCmV4cG9ydCB7IEF1dGggYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/Users/pro/Documents/WebWork/GitHub/iBlog-master/.nuxt/auth/auth.js"],"names":["Storage","routeOption","isRelativeURL","isSet","isSameURL","getProp","Auth","ctx","options","strategies","_errorListeners","_redirectListeners","initialState","user","loggedIn","storage","$storage","$state","state","resetOnError","onError","reset","syncUniversal","defaultStrategy","strategy","setUniversal","Promise","resolve","mounted","callOnError","process","client","watchLoggedIn","watchState","route","redirect","key","_get_state_warn_shown","console","warn","getState","name","getUniversal","fetchUserOnce","arguments","catch","error","method","reject","args","setStrategy","then","login","wrapLogin","fetchUser","logout","token","setUserToken","setToken","setUser","setRefreshToken","_key","prefix","refresh_token","refreshToken","setState","Boolean","endpoint","defaults","_endpoint","Object","assign","app","$axios","request","response","propertyName","data","getToken","tokenName","headers","promise","listener","push","payload","fn","noRouter","from","fullPathRedirect","fullPath","path","to","rewriteRedirects","callOnRedirect","window","location","replace","query","scope","userScopes","scopeKey","Array","isArray","includes","_state_warn_shown"],"mappings":"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","sourcesContent":["import Storage from './storage'\nimport { routeOption, isRelativeURL, isSet, isSameURL, getProp } from './utilities'\n\nexport default class Auth {\n  constructor (ctx, options) {\n    this.ctx = ctx\n    this.options = options\n\n    // Strategies\n    this.strategies = {}\n\n    // Error listeners\n    this._errorListeners = []\n\n    // Redirect listeners\n    this._redirectListeners = []\n\n    // Storage & State\n    options.initialState = { user: null, loggedIn: false }\n    const storage = new Storage(ctx, options)\n\n    this.$storage = storage\n    this.$state = storage.state\n  }\n\n  async init () {\n    // Reset on error\n    if (this.options.resetOnError) {\n      this.onError((...args) => {\n        if (typeof (this.options.resetOnError) !== 'function' || this.options.resetOnError(...args)) {\n          this.reset()\n        }\n      })\n    }\n\n    // Restore strategy\n    this.$storage.syncUniversal('strategy', this.options.defaultStrategy)\n\n    // Set default strategy if current one is invalid\n    if (!this.strategy) {\n      this.$storage.setUniversal('strategy', this.options.defaultStrategy)\n\n      // Give up if still invalid\n      if (!this.strategy) {\n        return Promise.resolve()\n      }\n    }\n\n    try {\n      // Call mounted for active strategy on initial load\n      await this.mounted()\n    } catch (error) {\n      this.callOnError(error)\n    } finally {\n      // Watch for loggedIn changes only in client side\n      if (process.client && this.options.watchLoggedIn) {\n        this.$storage.watchState('loggedIn', loggedIn => {\n          if (!routeOption(this.ctx.route, 'auth', false)) {\n            this.redirect(loggedIn ? 'home' : 'logout')\n          }\n        })\n      }\n    }\n  }\n\n  // Backward compatibility\n  get state () {\n    if (!this._state_warn_shown) {\n      this._state_warn_shown = true\n      // eslint-disable-next-line no-console\n      console.warn('[AUTH] $auth.state is deprecated. Please use $auth.$state or top level props like $auth.loggedIn')\n    }\n\n    return this.$state\n  }\n\n  getState (key) {\n    if (!this._get_state_warn_shown) {\n      this._get_state_warn_shown = true\n      // eslint-disable-next-line no-console\n      console.warn('[AUTH] $auth.getState is deprecated. Please use $auth.$storage.getState() or top level props like $auth.loggedIn')\n    }\n\n    return this.$storage.getState(key)\n  }\n\n  // ---------------------------------------------------------------\n  // Strategy and Scheme\n  // ---------------------------------------------------------------\n\n  get strategy () {\n    return this.strategies[this.$state.strategy]\n  }\n\n  registerStrategy (name, strategy) {\n    this.strategies[name] = strategy\n  }\n\n  setStrategy (name) {\n    if (name === this.$storage.getUniversal('strategy')) {\n      return Promise.resolve()\n    }\n\n    // Set strategy\n    this.$storage.setUniversal('strategy', name)\n\n    // Call mounted hook on active strategy\n    return this.mounted()\n  }\n\n  mounted () {\n    if (!this.strategy.mounted) {\n      return this.fetchUserOnce()\n    }\n\n    return Promise.resolve(this.strategy.mounted(...arguments)).catch(error => {\n      this.callOnError(error, { method: 'mounted' })\n      return Promise.reject(error)\n    })\n  }\n\n  loginWith (name, ...args) {\n    return this.setStrategy(name).then(() => this.login(...args))\n  }\n\n  login () {\n    if (!this.strategy.login) {\n      return Promise.resolve()\n    }\n\n    return this.wrapLogin(this.strategy.login(...arguments)).catch(error => {\n      this.callOnError(error, { method: 'login' })\n      return Promise.reject(error)\n    })\n  }\n\n  fetchUser () {\n    if (!this.strategy.fetchUser) {\n      return Promise.resolve()\n    }\n\n    return Promise.resolve(this.strategy.fetchUser(...arguments)).catch(error => {\n      this.callOnError(error, { method: 'fetchUser' })\n      return Promise.reject(error)\n    })\n  }\n\n  logout () {\n    if (!this.strategy.logout) {\n      this.reset()\n      return Promise.resolve()\n    }\n\n    return Promise.resolve(this.strategy.logout(...arguments)).catch(error => {\n      this.callOnError(error, { method: 'logout' })\n      return Promise.reject(error)\n    })\n  }\n\n  setUserToken (token) {\n    if (!this.strategy.setUserToken) {\n      this.setToken(this.strategy.name, token)\n      return Promise.resolve()\n    }\n\n    return Promise.resolve(this.strategy.setUserToken(token)).catch(error => {\n      this.callOnError(error, { method: 'setUserToken' })\n      return Promise.reject(error)\n    })\n  }\n\n  reset () {\n    if (!this.strategy.reset) {\n      this.setUser(false)\n      this.setToken(this.$state.strategy, false)\n      this.setRefreshToken(this.$state.strategy, false)\n      return Promise.resolve()\n    }\n\n    return Promise.resolve(this.strategy.reset(...arguments)).catch(error => {\n      this.callOnError(error, { method: 'reset' })\n      return Promise.reject(error)\n    })\n  }\n\n  // ---------------------------------------------------------------\n  // Token helpers\n  // ---------------------------------------------------------------\n\n  getToken (strategy) {\n    const _key = this.options.token.prefix + strategy\n\n    return this.$storage.getUniversal(_key)\n  }\n\n  setToken (strategy, token) {\n    const _key = this.options.token.prefix + strategy\n\n    return this.$storage.setUniversal(_key, token)\n  }\n\n  syncToken (strategy) {\n    const _key = this.options.token.prefix + strategy\n\n    return this.$storage.syncUniversal(_key)\n  }\n\n  // ---------------------------------------------------------------\n  // Refresh token helpers\n  // ---------------------------------------------------------------\n\n  getRefreshToken (strategy) {\n    const _key = this.options.refresh_token.prefix + strategy\n\n    return this.$storage.getUniversal(_key)\n  }\n\n  setRefreshToken (strategy, refreshToken) {\n    const _key = this.options.refresh_token.prefix + strategy\n\n    return this.$storage.setUniversal(_key, refreshToken)\n  }\n\n  syncRefreshToken (strategy) {\n    const _key = this.options.refresh_token.prefix + strategy\n\n    return this.$storage.syncUniversal(_key)\n  }\n\n  // ---------------------------------------------------------------\n  // User helpers\n  // ---------------------------------------------------------------\n\n  get user () {\n    return this.$state.user\n  }\n\n  get loggedIn () {\n    return this.$state.loggedIn\n  }\n\n  fetchUserOnce () {\n    if (!this.$state.user) {\n      return this.fetchUser(...arguments)\n    }\n    return Promise.resolve()\n  }\n\n  setUser (user) {\n    this.$storage.setState('user', user)\n    this.$storage.setState('loggedIn', Boolean(user))\n  }\n\n  // ---------------------------------------------------------------\n  // Utils\n  // ---------------------------------------------------------------\n\n  get busy () {\n    return this.$storage.getState('busy')\n  }\n\n  request (endpoint, defaults) {\n    const _endpoint =\n      typeof defaults === 'object'\n        ? Object.assign({}, defaults, endpoint)\n        : endpoint\n\n    if (!this.ctx.app.$axios) {\n      // eslint-disable-next-line no-console\n      console.error('[AUTH] add the @nuxtjs/axios module to nuxt.config file')\n      return\n    }\n\n    return this.ctx.app.$axios\n      .request(_endpoint)\n      .then(response => {\n        if (_endpoint.propertyName) {\n          return getProp(response.data, _endpoint.propertyName)\n        } else {\n          return response.data\n        }\n      })\n      .catch(error => {\n        // Call all error handlers\n        this.callOnError(error, { method: 'request' })\n\n        // Throw error\n        return Promise.reject(error)\n      })\n  }\n\n  requestWith (strategy, endpoint, defaults) {\n    const token = this.getToken(strategy)\n\n    const _endpoint = Object.assign({}, defaults, endpoint)\n\n    const tokenName = this.strategies[strategy].options.tokenName || 'Authorization'\n    if (!_endpoint.headers) {\n      _endpoint.headers = {}\n    }\n    if (!_endpoint.headers[tokenName] && isSet(token) && token) {\n      _endpoint.headers[tokenName] = token\n    }\n\n    return this.request(_endpoint)\n  }\n\n  wrapLogin (promise) {\n    this.$storage.setState('busy', true)\n    this.error = null\n\n    return Promise.resolve(promise)\n      .then(() => {\n        this.$storage.setState('busy', false)\n      })\n      .catch(error => {\n        this.$storage.setState('busy', false)\n        return Promise.reject(error)\n      })\n  }\n\n  onError (listener) {\n    this._errorListeners.push(listener)\n  }\n\n  callOnError (error, payload = {}) {\n    this.error = error\n\n    for (const fn of this._errorListeners) {\n      fn(error, payload)\n    }\n  }\n\n  redirect (name, noRouter = false) {\n    if (!this.options.redirect) {\n      return\n    }\n\n    const from = this.options.fullPathRedirect ? this.ctx.route.fullPath : this.ctx.route.path\n\n    let to = this.options.redirect[name]\n    if (!to) {\n      return\n    }\n\n    // Apply rewrites\n    if (this.options.rewriteRedirects) {\n      if (name === 'login' && isRelativeURL(from) && !isSameURL(to, from)) {\n        this.$storage.setUniversal('redirect', from)\n      }\n\n      if (name === 'home') {\n        const redirect = this.$storage.getUniversal('redirect')\n        this.$storage.setUniversal('redirect', null)\n\n        if (isRelativeURL(redirect)) {\n          to = redirect\n        }\n      }\n    }\n\n    // Call onRedirect hook\n    to = this.callOnRedirect(to, from) || to\n\n    // Prevent infinity redirects\n    if (isSameURL(to, from)) {\n      return\n    }\n\n    if (process.client) {\n      if (noRouter) {\n        window.location.replace(to)\n      } else {\n        this.ctx.redirect(to, this.ctx.query)\n      }\n    } else {\n      this.ctx.redirect(to, this.ctx.query)\n    }\n  }\n\n  onRedirect (listener) {\n    this._redirectListeners.push(listener)\n  }\n\n  callOnRedirect (to, from) {\n    for (const fn of this._redirectListeners) {\n      to = fn(to, from) || to\n    }\n    return to\n  }\n\n  hasScope (scope) {\n    const userScopes = this.$state.user && getProp(this.$state.user, this.options.scopeKey)\n\n    if (!userScopes) {\n      return false\n    }\n\n    if (Array.isArray(userScopes)) {\n      return userScopes.includes(scope)\n    }\n\n    return Boolean(getProp(userScopes, scope))\n  }\n}\n"]}]}